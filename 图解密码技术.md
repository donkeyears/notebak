- # 图解密码技术笔记
  ## 简介
  图解密码技术是日本作家结城浩的著作，主要用简单通俗易懂的方式介绍各种密码技术，尽量在不牵扯到数学推到的情况下讲解常见的密码技术。本书通俗易懂，但又不失严谨，点到密码的关键之处。是密码学了解的绝佳制作。
  密码学家工具箱中有六件宝贝，分别是：对称密码、公钥密码、单向散列函数、消息认证码、数字签名、伪随机数生成器。其中对称密码和公钥密码保证机密性，单向散列函数保证了消息的完整性，消息认证码可以在保证完整性的基础上防止篡改进行认证，数字签名在前二者的基础之上又添加了不可否认性。
  ## 历史上的密码
  - **凯撒密码**：一种简单的移位密码，按照字母表平移，比如a用d替换。破解方式：**暴力破解**
  - **简单替换密码**：字母表中每一个字母映射为表中另一个字母的方法。破解方式：**频率分析** 常见英文中出现的概率顺序是e,t,a,o,i,n,s···
  - **Enigma**：这是二战中德国使用的一种密码技术。每日根据密码本初始设置密码机，然后每按下一个按键，转子会旋转，不同层级的转子旋转次数不同。类似于滴水计时，越往后转的越慢。破译方法略。
  ## 对称密码
  密码学中异或运算用的比较多，主要是因为异或运算有一个性质，类比于**硬币翻转两次不改变状态**。两个相同的数异或为0，而0与任何数异或都不变。这样保证了加密的东西可以复原，而且加密和解密的时候进行的操作都是异或，可以重用。**明文与密码异或得密文，密文与密码再次异或恢复明文**
  **一次性密码本**使用随机比特序列串对明文进行加密，密钥长度与明文长度一致，理论上是无法破解的，但是现实中也是无法实现的。因为密钥的**配送、保存、重用、同步、生成**很难解决。
  ### DES(Data Encryption Standard)
  已经可以短时间内破解，因此不安全。
  **加密原理**：64bit分组，64bit密钥，但是每7bit一个校验位，实际有效位56bit。使用Feistel网络进行加密。
  Feistel网络把64bit分为左右两部分，右侧不变，与子密钥一起进入轮函数，输出与左侧异或。这是一轮，循环16轮为DES，其中每轮之间会调换左右
  **解密原理**：两次连续的Feistel网络即可复原。因为异或二次位明文。加密解密结构相同。多轮时子密钥的顺序决定了是加密还是解密。
  三重DES是在DES基础上改进而成。3是指进行三次DES。但是注意分别是加密，解密，加密。中间的解密是为了和DES兼容。如果三次的密钥相同的降级为DES，如1.3次DES使用相同密钥，则为DES-EDE2，三次都不同为DES_EDE3。
  ### AES(Advanced Encryption Standard)
  由竞选得到。最终选择Rijndael入选。分组为128bit，密钥常用的有128,256也有192.使用SPN结构。
  每一轮分为四步，SubBytes(简单替换),ShiftRows(行平移),MixColumns（列矩阵计算）,AddRoundKey（密钥异或）解密过程为逆运算即可。

  ## 分组密码的模式
  **分组密码** 每次只能处理特定长度的一块数据的密码算法。分组即分块。流密码是对数据列进行处理的密码算法。
  **模式** 长于分组的明文要进行多次的加密，这种迭代的方式就是模式。
  ### ECB(Electronic CodeBook mode)
  明文分组加密之后直接做密文分组。同一个分组加密结果一样，可以替换后破坏。比如收钱和打钱的顺序调换了就出错了。用户名替换密码了就好登陆了。
  ### CBC(Cipher Block Chaining mode)
  明文分组与前一个密文分组异或后再加密。第一次用初始化向量。
  如果一个密文分组被破坏，对应的明文与下一个明文被破坏，无法解密。如果缺失，则之后全废了。
  ### CFB(Cipher FeedBac mode)
  前一个密文分组送到密码算法输入端，用AES加密，此密文与明文异或做新密文。算法输出类似于一个流密码生成器是，生成了一个一次性密码本随机比特序列。
  **重放攻击**把密文放进去就会捣乱原本的顺序。
  ### OFB(Output FeedBack mode)
  密码算法输出送到输入端与明文异或，但是这儿的密码算法输入不是密文而是初始化向量一路加密而来，初始化向量确定一次次加密算法可以提前算好，也可以进行并行计算。
  ### CTR(CounTeR mode)
  用逐次累加的计数器加密得到密钥流，进行异或加密。这儿是用计数器值进行加密。而计数器是有一个随机数和分组号合并得到的数。可快速并行。
  ## 公钥密码
  解决密钥配送问题，公钥公开，私钥保留。类似储物柜取码存物。硬币是公钥。密钥配送可以有：事先共享、密钥中心分配、Diffie-Hellman密钥交换、公钥密码。
  ### 时钟运算
  时钟运算本质是求mod运算，求余数的运算。加法满则溢出归零。类似钟表。减法与加法互逆。乘法除法互逆。a*bmod N=1，则ab互为倒数。但是ab为整数。若aN最大公约数为1则a存在倒数。乘方也是原来的方法，但是求对数难度较大。
  ### RSA
  **密文=明文^E mod N**
  **明文=密文^D mod N**
  DN为私钥，EN为公钥。
  生成密钥对过程
  1. 求N。二大质数p*q=N
  2. 求L。L=lcm（p-1,q-1）最小公倍数
  3. 求E。E为1-L之间且EL最大公约数为1
  4. 求D。E*D mod L=1注意这儿数为L。

  ## 混合密码技术
  公钥加密对称密钥，对称密钥加密明文。
  ## 单向散列函数
  散列函数确保文件的完整性。
  - 任意长度消息输出固定长度散列
  - 可快速计算
  - 消息不同散列值不同
    **抗碰撞性**难以发现碰撞的性质。
  >弱抗碰撞性：找到与该**消息**同**散列值**的另外一条**消息**很难。
  >强抗碰撞性：找到**散列值**相同的**两条消息**很难。
  >常见的算法MD4、MD5.SHA1、SHA256、SHA384、SHA512.SHA3。其中sha3的结构为海绵体结构，sha1 2与之不同。目前sha1不安全。sha2还没有攻破。
  >sha1步骤
  1. 填充够512bit。首填1余填0.最后64bit填消息长度。
  2. 512bit计算出80个32bit数组。原始512bit分16份为W0-15.之后W（n）为n-16 n-14 n-8 n-3进行异或后左移1bit。
  3. 分组处理。五个初始缓冲区ABCDE进行运算。上一步每个W为一轮，80轮后再与初始缓冲区异或。每一轮bcd利用逻辑函数f运算再与e相加。a循环左移5bit与e相加。b循环左移30bit。e与W相加。e与系数K相加。然后abcde换位为eabcd。其中fk均与第几轮相关。
  4. 单步处理
    攻击方式，暴力攻击。生日功绩（N人中至少两人生日相同的概率**大于二分之一**，至少为根号下365，这样就降幂了。）
    SHA3为海绵体结构。每次对一个b长度比特进行运算。运算结果再与后续运算。b为一个5*5*z的立方体。立方体进行运算。
    单向散列函数可以辨别篡改，但是无法辨别伪装。识别伪装需要消息验证码
  ## 消息验证码
  消息验证码本质是在散列函数保证完整性的基础上再用对称密钥加密，这样非密钥持有者就无法伪造了。
  HMAC=hash(opadkey||hash(ipadkey||M))
  密钥用0填充够厚与ipad异或得ipadkey。

  使用双方都有的私钥，这样第三方没有密钥就无法伪造摘要。

  但是无法第三方证明，也就是无法防止否认，因此出现了下一张签名。

  ## 签名
  本质是用私钥加密散列值，这样任何有公钥的人都可以解密散列值了。RSA加密为公钥加密，私钥解密。这儿是公钥验证，私钥加密签名。由于私钥只有主人有，所以可以防抵赖。
  ## 证书  
  签名是否可信也是个问题，他的公钥是真的吗？这时候就需要一个权威机构去发布某人的证书去为其信用担保。

  证书机构用公钥加密签名的公钥，防止公钥被篡改。用户用CA公钥解密签名公钥，然后用签名公钥解密摘要，然后用摘要验证完整性。
  公钥基础设施PKI包含用户、认证机构、仓库。

  ## 随机数
  随机数必须随机（分布均匀）、不可预测性（不可从过去推未来）、不可重现（不重复，计算机无法达到。）
  三个条件要求依次提高。满足到前几的分别为弱随机数、强伪随机数、真随机数。
  线性同余法可生成随机的数字，但是不可以用在加密中，因为他的可预测性。c语言中的rand就是这样的。所以不可以用于加密。
  - 单向散列随机数。种子做初始计数器，然后计数器每次加1，之后散列（加密）为随机数。
  ## SSL/TLS
  二者很相近。
  TLS分为上下层，下层为记录协议，为对称密码对消息加密，消息认证。
  上层为握手协议。分为4部分。握手协议、密码规格变更协议、警告协议、应用数据协议。
  握手协议协商算法和共享密钥

  >密码的本质是将较长的秘密--消息--变成较短的秘密--密钥。    --布鲁斯·诗奈尔。
  >密码与压缩
  >和确保整个明文的机密性相比，确保密钥的机密性更容易。
  >和检查整个明文的完整性相比，检查散列值的完整性更容易。
  >和对整个消息进行认证相比，对mac值进行认证更容易。
  >和对整个消息进行认证相比，对签名的认证更容易
  >和确保整个随机序列的不可预测性相比，确保随机数种子的不可预测性更容易。
  >密钥是机密性的精华
  >散列值是完整性的精华
  >认证符号是认证的精华
  >种子是不可预测性的精华。
  >都是压缩。

  ​

  ​

  ​

  ​

  ​

  ​

  ​
